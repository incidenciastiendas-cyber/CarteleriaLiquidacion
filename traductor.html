<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Traductor Master - Cenefas Promocionales</title>
    <link rel="icon" type="image/png" href="fonts/gdnicon.png" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
    />
    <link rel="stylesheet" href="styles/traductor-styles.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  </head>
  <body>
    <header>
      <div class="header-content">
        <div class="header-left">
          <span class="material-icons header-icon">auto_fix_high</span>
          <div>
            <h1>Traductor Master</h1>
            <p class="subtitle">
              Convierte tu Excel de eventos a formato Cenefas Promocionales
            </p>
          </div>
        </div>
        <div class="header-actions">
          <a href="cenefas.html" class="btn btn-primary">
            <span class="material-icons">palette</span>
            Ir a Cenefas Promocionales
          </a>
          <a href="home.html" class="btn btn-back">
            <span class="material-icons">home</span>
            Volver al Home
          </a>
        </div>
      </div>
    </header>

    <main class="container">
      <!-- Secci√≥n de carga -->
      <section class="upload-section">
        <div class="upload-card">
          <span class="material-icons upload-icon">upload_file</span>
          <h2>Cargar Master de Eventos</h2>
          <p>Arrastra tu archivo Excel aqu√≠ o haz clic para seleccionar</p>
          <input
            type="file"
            id="file-input"
            accept=".xlsx,.xls"
            style="display: none"
          />
          <div class="drop-zone" id="drop-zone">
            <span class="drop-text">Arrastra tu Excel aqu√≠</span>
            <button
              class="btn btn-upload"
              onclick="document.getElementById('file-input').click()"
            >
              <span class="material-icons">folder_open</span>
              Seleccionar archivo
            </button>
          </div>
          <div class="file-info" id="file-info" style="display: none">
            <span class="material-icons" style="color: #10b981"
              >check_circle</span
            >
            <span id="file-name"></span>
            <button class="btn btn-small" onclick="resetUpload()">
              <span class="material-icons">refresh</span>
              Cambiar archivo
            </button>
          </div>
        </div>
      </section>

      <!-- Secci√≥n de procesamiento -->
      <section
        class="processing-section"
        id="processing-section"
        style="display: none"
      >
        <div class="processing-card">
          <div class="spinner"></div>
          <h3>Procesando datos...</h3>
          <p>Aplicando reglas de transformaci√≥n</p>
        </div>
      </section>

      <!-- Secci√≥n de resultados -->
      <section
        class="results-section"
        id="results-section"
        style="display: none"
      >
        <div class="results-header">
          <h2>
            <span
              class="material-icons"
              style="vertical-align: middle; color: #10b981"
              >check_circle</span
            >
            Procesamiento Completado
          </h2>
          <div class="actions">
            <button
              class="btn btn-primary"
              onclick="enviarACenefas()"
              style="font-weight: 600"
            >
              <span class="material-icons">palette</span>
              Enviar a Cenefas Promocionales
            </button>
            <button class="btn btn-success" onclick="downloadCSV()">
              <span class="material-icons">download</span>
              Descargar CSV
            </button>
            <button class="btn btn-info" onclick="resetUpload()">
              <span class="material-icons">refresh</span>
              Procesar otro archivo
            </button>
          </div>
        </div>

        <!-- Estad√≠sticas -->
        <div class="stats-grid">
          <div class="stat-card primary">
            <span class="material-icons stat-icon">insert_chart</span>
            <div class="stat-content">
              <div class="stat-label">Filas Originales</div>
              <div class="stat-value" id="stat-original">0</div>
            </div>
          </div>

          <div class="stat-card success">
            <span class="material-icons stat-icon">done_all</span>
            <div class="stat-content">
              <div class="stat-label">Filas Procesadas</div>
              <div class="stat-value" id="stat-procesadas">0</div>
            </div>
          </div>

          <div class="stat-card info">
            <span class="material-icons stat-icon">local_offer</span>
            <div class="stat-content">
              <div class="stat-label">Promociones √önicas</div>
              <div class="stat-value" id="stat-unicas">0</div>
            </div>
          </div>

          <div class="stat-card warning">
            <span class="material-icons stat-icon">stars</span>
            <div class="stat-content">
              <div class="stat-label">Total M√°sClub</div>
              <div class="stat-value" id="stat-masclub">0</div>
            </div>
          </div>
        </div>

        <!-- Detalle por tipo -->
        <div class="detail-section">
          <h3>
            <span class="material-icons" style="vertical-align: middle"
              >analytics</span
            >
            Detalle por Tipo de Promoci√≥n
          </h3>

          <div class="detail-grid">
            <!-- M√°sClub -->
            <div class="detail-card">
              <h4>
                <span
                  class="material-icons"
                  style="vertical-align: middle; font-size: 20px"
                  >stars</span
                >
                M√°sClub
              </h4>
              <ul id="detail-masclub"></ul>
            </div>

            <!-- Regulares -->
            <div class="detail-card">
              <h4>
                <span
                  class="material-icons"
                  style="vertical-align: middle; font-size: 20px"
                  >local_offer</span
                >
                Promociones Regulares
              </h4>
              <ul id="detail-regular"></ul>
            </div>

            <!-- Por Departamento -->
            <div class="detail-card full-width">
              <h4>
                <span
                  class="material-icons"
                  style="vertical-align: middle; font-size: 20px"
                  >category</span
                >
                Cenefas por Departamento
              </h4>
              <ul id="detail-departamento"></ul>
            </div>
          </div>
        </div>

        <!-- Preview de datos -->
        <div class="preview-section">
          <h3>
            <span class="material-icons" style="vertical-align: middle"
              >visibility</span
            >
            Vista Previa de Datos Procesados (primeros 20)
          </h3>
          <div class="table-container">
            <table id="preview-table">
              <thead>
                <tr>
                  <th>Tipo Acci√≥n</th>
                  <th>Desde</th>
                  <th>Hasta</th>
                  <th>T√≠tulo Acci√≥n</th>
                  <th>Incluye/Excluye</th>
                  <th>Aclaraci√≥n 2</th>
                  <th>Legal 1</th>
                  <th>Legal 2</th>
                </tr>
              </thead>
              <tbody id="preview-body"></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Ayuda -->
      <section class="help-section">
        <button class="btn btn-help" onclick="toggleHelp()">
          <span class="material-icons">help_outline</span>
          Gu√≠a de Uso Traductor
        </button>
        <div class="help-content" id="help-content" style="display: none">
          <h3>
            <span class="material-icons" style="vertical-align: middle"
              >description</span
            >
            Gu√≠a de Uso Traductor
          </h3>

          <div class="rule-group">
            <h4>üìã Pasos del Procesamiento</h4>
            <ol style="margin-left: 20px; line-height: 1.8">
              <li>
                <strong>Filtrar:</strong> Solo filas con Testimonial = "SI"
              </li>
              <li>
                <strong>Procesar cada fila:</strong> Extraer CSI, CCQ,
                Incluye/Excluye, Hasta%, tipo de acci√≥n
              </li>
              <li>
                <strong>Filtrar departamentos:</strong> Si tipo = "$precio",
                solo dptos 80, 43, 21, 93, 98
              </li>
              <li>
                <strong>Combinar MC+Regular:</strong> Si hay 25% y 30%MC del
                mismo t√≠tulo ‚Üí crear 25%O30%MC y eliminar las 2 originales
              </li>
              <li>
                <strong>Unificar t√≠tulos:</strong> Agrupar por departamento+tipo
                ‚Üí unir t√≠tulos (m√°x 4, cada uno &lt;30 caracteres)
              </li>
              <li>
                <strong>Generar CSV:</strong> Con punto y coma (;) como
                separador
              </li>
            </ol>
          </div>

          <div class="rule-group">
            <h4>üîÑ Tipo de Acci√≥n</h4>
            <p>‚Ä¢ <code>1x25%</code> ‚Üí <code>25%</code></p>
            <p>‚Ä¢ <code>2x1</code> ‚Üí <code>2x1</code></p>
            <p>‚Ä¢ <code>#2x70%</code> ‚Üí <code>70%2</code></p>
            <p>‚Ä¢ <code>$13333</code> ‚Üí <code>$13333</code></p>
            <p>‚Ä¢ Si <code>Tu Club = "Si"</code> ‚Üí Se agrega "MC" al final</p>
            <p>
              ‚Ä¢ <code>Mas 6CSI</code> o <code>6 CSI</code> ‚Üí <code>+6Q</code>
            </p>
          </div>

          <div class="rule-group">
            <h4>üìù Procesamiento de T√≠tulo</h4>
            <p>
              ‚Ä¢ <code>Hasta 30% en adornos</code> ‚Üí Tipo: <code>H30%</code>,
              T√≠tulo: <code>En adornos</code>
            </p>
            <p>
              ‚Ä¢ <code>CCQ</code> o <code>Combinalo como quieras</code> ‚Üí Va a
              "Aclaraci√≥n 2"
            </p>
            <p>
              ‚Ä¢ <code>Coca cola excluye envases</code> ‚Üí T√≠tulo:
              <code>Coca cola</code>, Incluye/Excluye:
              <code>Excluye envases</code>
            </p>
          </div>

          <div class="rule-group">
            <h4>üîó Combinaci√≥n MC + Regular</h4>
            <p>‚Ä¢ Mismo t√≠tulo con versi√≥n regular (25%) y M√°sClub (30%MC)</p>
            <p>‚Ä¢ Se combina en: <code>25%O30%MC</code></p>
            <p>‚Ä¢ Las dos filas originales se eliminan autom√°ticamente</p>
          </div>
        </div>
      </section>
    </main>

    <script src="js/traductor-app.js"></script>
  </body>
</html>
