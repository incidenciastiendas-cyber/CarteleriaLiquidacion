<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Cenefas Promocionales ‚Äî Previsualizador</title>
    <link rel="icon" type="image/png" href="fonts/gdnicon.png" />
    <link rel="stylesheet" href="styles/cenefas-styles.css" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
    />
  </head>
  <body style="background: var(--app-background); min-height: 100vh">
    <div class="app">
      <header
        style="
          background: white;
          padding: 30px;
          border-radius: 16px;
          margin-bottom: 24px;
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        "
      >
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
          "
        >
          <div style="display: flex; align-items: center; gap: 15px">
            <div
              style="
                width: 50px;
                height: 50px;
                background: #3d60fb;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                flex-shrink: 0;
              "
            >
              <img
                src="fonts/gdnicon.png"
                alt="Logo"
                style="width: 35px; height: 35px"
              />
            </div>
            <div>
              <h1 style="margin: 0; font-size: 28px">Cenefas Promocionales</h1>
              <p class="muted" style="margin: 0">
                App para creaci√≥n de cenefas A5 horizontales para promociones
                (2x1, 3x2, etc.)
              </p>
            </div>
          </div>
          <div style="display: flex; align-items: center; gap: 15px">
            <div
              style="
                display: flex;
                align-items: center;
                gap: 10px;
                background: #f3f4f6;
                padding: 10px 20px;
                border-radius: 50px;
              "
            >
              <div
                style="
                  width: 40px;
                  height: 40px;
                  background: var(--user-icon-default-bg);
                  border-radius: 50%;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  color: white;
                  font-weight: bold;
                "
                id="user-icon-cen"
              ></div>
              <span style="font-weight: 600; color: #1f2937" id="user-name-cen"
                >Usuario</span
              >
            </div>
            <button
              onclick="logout()"
              style="
                padding: 10px 20px;
                background: #ef4444;
                color: white;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 600;
                cursor: pointer;
                display: inline-flex;
                align-items: center;
                gap: 6px;
                min-height: 40px;
                height: 40px;
              "
            >
              <span class="material-icons" style="font-size: 18px">logout</span>
              Salir
            </button>
          </div>
        </div>
      </header>

      <div class="controls">
        <div class="controls-group">
          <a href="home.html" class="btn-cenefas">
            <span
              class="material-icons"
              style="font-size: 18px; margin-right: 4px"
              >home</span
            >
            Volver al Inicio
          </a>
          <button id="btn-ayuda" class="btn btn-info" style="padding: 8px 16px">
            <span
              class="material-icons"
              style="font-size: 18px; margin-right: 4px"
              >help</span
            >
            ¬øC√≥mo usar?
          </button>
          <button id="btn-download-template" class="btn btn-info">
            <span
              class="material-icons"
              style="font-size: 18px; margin-right: 4px"
              >description</span
            >
            Descargar Template CSV
          </button>
        </div>
        <div class="controls-group">
          <div class="file-input-wrapper">
            <label for="file-csv" class="btn btn-file"
              ><span
                class="material-icons"
                style="font-size: 18px; margin-right: 4px"
                >folder_open</span
              >
              Seleccionar CSV</label
            >
            <input id="file-csv" type="file" accept=".csv" />
          </div>
          <button id="btn-import" class="btn btn-file">Importar CSV</button>
          <button id="btn-export-draft" class="btn btn-info">
            <span
              class="material-icons"
              style="font-size: 18px; margin-right: 4px"
              >save</span
            >
            Guardar Borrador
          </button>
        </div>
        <div class="controls-group">
          <button id="btn-add" class="btn btn-success">
            <span
              class="material-icons"
              style="font-size: 18px; margin-right: 4px"
              >add</span
            >
            Agregar cenefa
          </button>
          <button id="btn-delete-selected" class="btn btn-danger">
            <span
              class="material-icons"
              style="font-size: 18px; margin-right: 4px"
              >delete</span
            >
            Eliminar seleccionados
          </button>
          <button id="btn-toggle-compact" class="btn btn-secondary">
            <span
              class="material-icons"
              style="font-size: 18px; margin-right: 4px"
              >expand_less</span
            >
            Contraer Tabla
          </button>
        </div>
        <div class="controls-group">
          <button id="btn-preview" class="btn btn-primary">
            <span
              class="material-icons"
              style="font-size: 18px; margin-right: 4px"
              >preview</span
            >
            Crear Cenefas
          </button>
          <button id="btn-download-selected" class="btn btn-success">
            <span
              class="material-icons"
              style="font-size: 18px; margin-right: 4px"
              >download</span
            >
            Descargar Seleccionadas
          </button>
          <button id="btn-print-all" class="btn btn-info">
            <span
              class="material-icons"
              style="font-size: 18px; margin-right: 4px"
              >picture_as_pdf</span
            >
            Descargar Todo (PDF √∫nico)
          </button>
        </div>
      </div>

      <main>
        <section class="table-section">
          <table id="cenefas-table">
            <thead>
              <tr>
                <th style="width: 35px">
                  <input id="select-all" type="checkbox" />
                </th>
                <th style="width: 100px">Tipo</th>
                <th>Acci√≥n</th>
                <th>Desde</th>
                <th>Hasta</th>
                <th>T√≠tulo Acci√≥n</th>
                <th>Incluye/Excluye</th>
                <th>Aclaraci√≥n 2</th>
                <th>Legal 1</th>
                <th>Legal 2</th>
                <th></th>
                <th>Ver</th>
              </tr>
            </thead>
            <tbody id="cenefas-body"></tbody>
          </table>
        </section>

        <section id="preview-section" class="preview-section hidden">
          <h2>Vista previa</h2>
          <div id="preview-list"></div>
        </section>
      </main>

      <!-- FEATURE-BackToTop: Bot√≥n flotante para volver arriba -->
      <button
        id="btn-back-to-top"
        class="btn-back-to-top"
        style="display: none"
        title="Volver arriba"
      >
        <span class="material-icons" style="font-size: 24px">arrow_upward</span>
      </button>

      <!-- FEATURE-ModalAlerts: Modal para mensajes -->
      <div id="modal-mensaje" class="modal-mensaje" style="display: none">
        <div class="modal-mensaje-content">
          <span class="modal-mensaje-close">√ó</span>
          <p id="modal-mensaje-texto"></p>
          <button id="modal-mensaje-ok" class="btn btn-primary">OK</button>
        </div>
      </div>

      <!-- Modal de Confirmaci√≥n -->
      <div id="modal-confirm" class="modal-mensaje" style="display: none">
        <div class="modal-mensaje-content">
          <p id="modal-confirm-texto"></p>
          <div
            style="
              display: flex;
              gap: 12px;
              justify-content: center;
              margin-top: 20px;
            "
          >
            <button id="modal-confirm-si" class="btn btn-primary">
              S√≠, confirmar
            </button>
            <button id="modal-confirm-no" class="btn btn-secondary">
              Cancelar
            </button>
          </div>
        </div>
      </div>

      <!-- Modal de Ayuda -->
      <div id="modal-ayuda" class="modal-ayuda" style="display: none">
        <div class="modal-content-ayuda">
          <span class="close-ayuda">√ó</span>
          <h2>üìò Gu√≠a de Uso - Cenefas Promocionales</h2>

          <div class="ayuda-seccion">
            <h3>1Ô∏è‚É£ ¬øQu√© es una cenefa?</h3>
            <p>
              Una cenefa es un cartel promocional de formato A5 horizontal
              (595x420px) que se usa para mostrar ofertas especiales en las
              tiendas. El sistema genera autom√°ticamente 2 cenefas por hoja A4
              para imprimir.
            </p>
          </div>

          <div class="ayuda-seccion">
            <h3>2Ô∏è‚É£ Formas de cargar datos</h3>
            <h4>üìã Opci√≥n 1: Importar CSV (Recomendado)</h4>
            <ol>
              <li>Hac√© clic en <strong>"üìÑ Descargar Template CSV"</strong></li>
              <li>Abr√≠ el archivo descargado con Excel o Google Sheets</li>
              <li>Complet√° los datos siguiendo los ejemplos incluidos</li>
              <li>Guard√° el archivo como CSV</li>
              <li>
                Hac√© clic en <strong>"üìÅ Seleccionar CSV"</strong> y seleccion√°
                tu archivo
              </li>
              <li>Hac√© clic en <strong>"Importar CSV"</strong></li>
            </ol>

            <h4>‚úèÔ∏è Opci√≥n 2: Cargar manualmente</h4>
            <ol>
              <li>Hac√© clic en <strong>"+ Agregar cenefa"</strong></li>
              <li>Complet√° los campos en la tabla</li>
              <li>Pod√©s agregar m√∫ltiples cenefas repitiendo el proceso</li>
            </ol>
          </div>

          <div class="ayuda-seccion">
            <h3>3Ô∏è‚É£ C√≥digos de Oferta - Detecci√≥n Autom√°tica</h3>
            <p>
              <strong
                >El sistema detecta autom√°ticamente el tipo de oferta</strong
              >
              seg√∫n el c√≥digo que ingreses:
            </p>

            <table class="tabla-ejemplos">
              <tr>
                <th>C√≥digo</th>
                <th>Tipo</th>
                <th>Ejemplo Visual</th>
              </tr>
              <tr>
                <td><code>2X1</code>, <code>3X2</code></td>
                <td>Llev√° X Pag√° Y</td>
                <td>N√∫mero grande + X may√∫scula + N√∫mero</td>
              </tr>
              <tr>
                <td><code>$3999</code></td>
                <td>Precio fijo</td>
                <td>$ peque√±o + N√∫mero grande</td>
              </tr>
              <tr>
                <td><code>40%</code></td>
                <td>Descuento simple</td>
                <td>N√∫mero grande + % peque√±o</td>
              </tr>
              <tr>
                <td><code>H30%</code></td>
                <td>Hasta X% descuento</td>
                <td>HASTA arriba + N√∫mero + %</td>
              </tr>
              <tr>
                <td><code>H30%MC</code></td>
                <td>Hasta X% M√°sClub</td>
                <td>Banner azul + HASTA arriba + N√∫mero + %</td>
              </tr>
              <tr>
                <td><code>30%2</code></td>
                <td>Descuento 2da unidad</td>
                <td>N√∫mero + % arriba del texto</td>
              </tr>
              <tr>
                <td><code>6Q</code>, <code>12</code></td>
                <td>Cuotas sin inter√©s</td>
                <td>N√∫mero + "CUOTAS SIN INTER√âS"</td>
              </tr>
              <tr>
                <td><code>30%+4Q</code></td>
                <td>Descuento + Cuotas</td>
                <td>30% + 4 en fila superior, textos abajo</td>
              </tr>
              <tr>
                <td><code>30%+6QMC</code></td>
                <td>Descuento + Cuotas MC</td>
                <td>Banner M√°sClub + 30% + 6 cuotas</td>
              </tr>
              <tr>
                <td><code>80%MC</code></td>
                <td>Descuento M√°sClub</td>
                <td>Banner azul EXCLUSIVO + logo + descuento</td>
              </tr>
              <tr>
                <td><code>30%o35%MC</code></td>
                <td>Doble descuento MC</td>
                <td>Vigencia + 30% general + 35% M√°sClub</td>
              </tr>
              <tr>
                <td><code>35%2MC</code></td>
                <td>2da unidad MC</td>
                <td>Banner azul + 35% en 2da unidad</td>
              </tr>
              <tr>
                <td><code>2X1MC</code></td>
                <td>Llev√° X Pag√° Y MC</td>
                <td>Banner azul + 2X1 estilo M√°sClub</td>
              </tr>
              <tr>
                <td><code>3X2o4X2MC</code></td>
                <td>Doble NxN MC</td>
                <td>Vigencia + 3X2 general + 4X2 M√°sClub</td>
              </tr>
            </table>
          </div>

          <div class="ayuda-seccion">
            <h3>4Ô∏è‚É£ Campos del Formulario</h3>
            <ul>
              <li>
                <strong>Tipo Acci√≥n</strong> (obligatorio): C√≥digos como 2X1,
                3X2, $3999, 40%, H30%, H30%MC, 30%2, 6Q, 30%+4Q, 30%+6QMC,
                80%MC, 30%o35%MC, 35%2MC, 2X1MC, 3X2o4X2MC, 80%2O2X1MC. Los textos se
                generan autom√°ticamente seg√∫n el c√≥digo ingresado. Los precios se muestran con separador de miles.
              </li>
              <li>
                <strong>Desde/Hasta</strong>: Fechas de vigencia (formato:
                25/11)
              </li>
              <li>
                <strong>T√≠tulo Acci√≥n</strong>: Descripci√≥n del
                producto/promoci√≥n
              </li>
              <li>
                <strong>Incluye/Excluye</strong> (opcional): Detalles de
                inclusi√≥n/exclusi√≥n
              </li>
              <li>
                <strong>Aclaraci√≥n 2</strong> (opcional): Ej: "COMBINALO COMO
                QUIERAS"
              </li>
              <li>
                <strong>Legal 1 y 2</strong>: Textos legales al pie de la cenefa (se generan autom√°ticamente desde el Traductor)
              </li>
            </ul>
          </div>

          <div class="ayuda-seccion">
            <h3>5Ô∏è‚É£ Integraci√≥n con Traductor Master</h3>
            <p>
              Pod√©s cargar cenefas directamente desde el <strong>Traductor Master</strong>:
            </p>
            <ol>
              <li>Proces√° un archivo Excel en el Traductor Master</li>
              <li>Hac√© clic en <strong>"Enviar a Cenefas Promocionales"</strong></li>
              <li>Las cenefas se cargar√°n autom√°ticamente con todos los datos y legales correspondientes</li>
            </ol>
          </div>

          <div class="ayuda-seccion">
            <h3>6Ô∏è‚É£ Generar y Descargar</h3>
            <ol>
              <li>
                Una vez cargados los datos, hac√© clic en
                <strong>"üìã Crear Cenefas"</strong>
              </li>
              <li>Se mostrar√° la vista previa de todas las cenefas</li>
              <li>
                Pod√©s descargar:
                <ul>
                  <li>
                    <strong>Hoja A4 completa</strong> (2 cenefas por hoja)
                  </li>
                  <li><strong>Solo primera cenefa</strong> (individual)</li>
                  <li><strong>Todas las cenefas</strong> en un solo PDF</li>
                </ul>
              </li>
            </ol>
          </div>

          <div class="ayuda-seccion">
            <h3>‚úÖ Consejos √ötiles</h3>
            <ul>
              <li>
                ‚úÖ Descarg√° el template CSV para tener ejemplos de cada tipo
              </li>
              <li>‚úÖ Us√° la vista previa antes de descargar para verificar</li>
              <li>
                ‚úÖ Pod√©s eliminar cenefas seleccion√°ndolas y haciendo clic en
                "üóëÔ∏è Eliminar"
              </li>
              <li>
                ‚úÖ Los textos legales se ajustan autom√°ticamente al espacio
                disponible
              </li>
            </ul>
          </div>
        </div>
      </div>

      <footer>
        <small class="muted"
          >Creado por IncidenciasTiendas@gdnargentina.com</small
        >
      </footer>
    </div>

    <!-- Dependencias CDN -->
    <!-- <script src="users.js"></script> -->
    <!-- <script src="auth.js"></script> -->
    <script>
      // requireAuth();

      // Funci√≥n para obtener iniciales (Rodrigo Bernel -> RB)
      function getInitials(name) {
        const words = name.trim().split(/\s+/);
        if (words.length === 1) {
          return words[0].substring(0, 2).toUpperCase();
        }
        return (
          words[0].charAt(0) + words[words.length - 1].charAt(0)
        ).toUpperCase();
      }

      // Funci√≥n para generar color consistente por hash
      function getAvatarColor(name) {
        const colors = [
          "#667eea",
          "#f093fb",
          "#4facfe",
          "#43e97b",
          "#feca57",
          "#ee5a6f",
        ];
        let hash = 0;
        for (let i = 0; i < name.length; i++) {
          hash = name.charCodeAt(i) + ((hash << 5) - hash);
        }
        return colors[Math.abs(hash) % colors.length];
      }

      // Mostrar informaci√≥n del usuario
      // const user = getCurrentUser();
      // if (user) {
      //   document.getElementById("user-name-cen").textContent = user.name;
      //   const initials = getInitials(user.name);
      //   const userIcon = document.getElementById("user-icon-cen");
      //   userIcon.textContent = initials;
      //   userIcon.style.backgroundColor = getAvatarColor(user.name);
      // }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="js/cenefas-app.js"></script>
  </body>
</html>
